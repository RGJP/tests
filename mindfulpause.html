<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mindfulness Pause v2.4</title>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Styles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <style>
    /* Countdown splash */
    #countdown-overlay{
      position:fixed;inset:0;
      width:100vw;height:100vh;
      background:rgba(22,45,77,.95);
      display:none;align-items:center;justify-content:center;
      z-index:1000
    }
    #countdown-number{
      font-size:10rem;color:#ffd700;font-weight:bold;
      animation:pop 1s ease-in-out infinite
    }
    @keyframes pop{
      0%{transform:scale(1);opacity:1}
      50%{transform:scale(1.3);opacity:.7}
      100%{transform:scale(1);opacity:1}
    }

    /* Page */
    body{
      background:#162d4d;color:#ffd700;
      font-family:Arial,Helvetica,sans-serif;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      min-height:100vh;margin:0;padding:20px;text-align:center
    }
    h1{font-size:3rem;margin-bottom:2rem}

    /* Buttons */
    .button-container{display:flex;gap:20px;margin-bottom:30px}
    button{
      background:rgba(255,215,0,.2);color:#ffd700;border:2px solid #ffd700;
      padding:12px 24px;font-size:1.2rem;cursor:pointer;border-radius:8px;
      transition:all .3s ease
    }
    button:hover{background:rgba(255,215,0,.4)}
    button:disabled{opacity:.5;cursor:not-allowed}

    /* Messages */
    .message{margin-top:10px;font-size:1.2rem;min-height:50px}
    .speaker-name{font-size:1rem;margin-bottom:5px}
  </style>
</head>

<body>
  <h1>üßò‚Äç‚ôÇÔ∏è Mindfulness Pause üßò</h1>

  <!-- Controls -->
  <div class="button-container">
    <button id="five-min">5&nbsp;Minutes</button>
    <button id="seven-min">7&nbsp;Minutes</button>
    <button id="ten-min">10&nbsp;Minutes</button>
  </div>

  <!-- Status -->
  <div id="duration-message" style="font-size:1.5rem;margin-bottom:20px;"></div>

  </div>
  <div class="speaker-name" id="speaker-name"></div>
  <div class="message" id="message"></div>

  <!-- Countdown overlay -->
  <div id="countdown-overlay">
    <div id="countdown-number">7</div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Script ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    (() => {
      'use strict';

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Environment check ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      const ua = navigator.userAgent.toLowerCase();
      const isAndroid = ua.includes('android');
      const isEdge    = ua.includes('edg/') || ua.includes('edga') || ua.includes('edge');
      if (isAndroid) {
        alert('This WebApp is currently not supported on Android devices due to a known issue in Edge for Android that remains unfixed by Microsoft.');
        return;
      }
      if (!isEdge) {
        alert('This WebApp only works in Microsoft Edge on desktop for improved voice quality. Please open this page in Microsoft Edge.');
        return;
      }

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DOM helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      const $ = id => document.getElementById(id);

      const btn5  = $('five-min');
      const btn7  = $('seven-min');
      const btn10 = $('ten-min');
      const msg          = $('message');
      const speakerLabel = $('speaker-name');
      const durMsg       = $('duration-message');

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Meditation text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      const rand = a => a[Math.random()*a.length | 0];

      const scriptVariations = {
        0: [
          "Welcome. Let's begin. First, find a comfortable position and gently close your eyes.",
          "Welcome. Start by settling into a relaxed position. Softly close your eyes.",
          "Welcome. Begin by finding a comfortable position. Close your eyes gently and rest your hands.",
          "Welcome. Let's start by getting comfortable. Close your eyes and bring your focus inward.",
          "Welcome. Take a moment to get settled. Find stillness and softly let your eyes close.",
          "Welcome. Ease into stillness by finding a relaxed posture, and gently close your eyes.",
          "Welcome. Begin in a comfortable, restful position. Close your eyes and let your attention turn inward."
        ],
        30: [
          "Take a few deep breaths. In through your nose, and out through your mouth. Let your body settle on its own.",
          "Breathe deeply, inhale through the nose, exhale through the mouth. Let yourself arrive here, in this moment.",
          "Take deep breaths. Feel the air enter and leave. In through the nose, and out through the mouth.",
          "Inhale deeply... exhale fully, in through the nose, and out through the mouth. Allow each breath to settle your body and mind.",
          "Breathe in deeply... and breathe out fully through your mouth. Let your breath bring you to the Now.",
          "Draw in a full breath, and release it fully through your mouth. Let your body start to unwind."
        ],
        60: [
          "Begin to notice how your body feels. Soften any tension in your face, your jaw, your shoulders, your hands. Releasing all tension from head to toe.",
          "Start scanning your body from head to toe. Relax your shoulders, your face, your hands. Let tension dissolve on its own.",
          "Tune into your physical body. Gently release any tightness in your jaw, your neck, your hands, in all areas of the body.",
          "Feel into your body. Allow each part to soften. Your face, your chest, your limbs, the whole body.",
          "Bring attention to your body. Loosen the areas that feel tight. Let go of tension.",
          "Gently check in with your body. Soften any tight areas. Let tension melt away.",
          "Let your body relax. Soften your face, your hands, your belly, your whole body. Let tension dissolve."
        ],
        90: [
          "Bring awareness to surrounding sounds and any sensations within. Notice your current mood and any emotions present. Let everything be as it is, like clouds in the sky.",
          "Listen to the sounds around you. Feel sensations as they come and go. Let your emotions be, without judgment.",
          "Observe the moment‚Äîsounds, feelings, thoughts‚Äîwithout clinging. Let everything drift by like clouds.",
          "Feel the world around and within you. Allow it all to flow without needing to change anything. Everything comes and goes, you simply observe.",
          "Notice what‚Äôs present, within and around you. Let it be, just as it is.",
          "Bring awareness to surrounding sounds and any sensations within. Notice your current mood and any emotions present. Let them rise and fall like waves."
        ],
        120: [
          "..."
        ],
        180: [
          "Settle your attention on the breath. Notice its natural rhythm, rising with the inhale, falling with the exhale. Nothing else to do.",
          "Bring your focus to the breath. Feel it flow in and out, naturally. Nothing to do at all. Nothing to change.",
          "Notice the breath, how it moves in your body. Rising and falling. Let it guide your awareness gently.",
          "Focus on the breath. Inhale, exhale, rise and fall. Let the natural rhythm soothe you into stillness.",
          "Feel your breath like a gentle wave, riding it moment by moment, rising and falling."
        ],
        240: [
          "Nothing to change, simply witnessing.",
          "Everything comes and goes, as it is. Just observing.",
          "Be the simple observer. Let things be as they are.",
          "Resting in awareness, everything as it is, nothing to change.",
          "Simply witnessing, nothing to pursue, nothing to reject."
        ],
        270: [
          "As we begin to close, take a few deep breaths and exhale letting go of any remaining tension.",
          "As we begin to close, take some deep breaths. Inhale peace... exhale any remaining tension.",
          "As we near the end of the meditation, breathe in gently... and breathe out with ease."
        ],
        290: [
          "Gently start to wiggle your fingers and toes. Bring movement back to the body.",
          "Begin to move your body slowly‚Äîwiggle your fingers, your toes‚Äîfeel into the physical world.",
          "Awaken the body with gentle movements; stretch or shift softly.",
          "Introduce some small movements back to the body, gently rotate your wrists or ankles.",
          "Let movement return naturally: small shifts in your body, light stretches.",
          "Ease your way back with subtle motion. Stretch and move the body gently."
        ],
        295: [
          "When you're ready, slowly open your eyes. Notice this sense of stillness and calm with you.",
          "Slowly open your eyes when you're ready. Take some time to feel the difference in your inner state.",
          "Open your eyes at your own pace, bringing that gentle awareness with you.",
          "When ready, let your eyes open gently. Notice that stillness within.",
          "In your own time, let your eyes open slowly, soft and easy.",
          "Open your eyes when it feels right, returning with a sense of quiet clarity.",
          "Let the world come back into focus. Eyes open, heart calm."
        ],
        300: [
          "Your mindfulness pause is complete. Wishing you a peaceful rest of your day. Until next time, goodbye.",
          "Your meditation is complete. Take this stillness with you; have a beautiful day ahead. Until next time, goodbye.",
          "You've completed a moment of mindful presence‚Äîwell done. May the rest of your day unfold with ease. Until next time, goodbye.",
          "Your pause is complete. Carry this calm with you into whatever comes next. Be well. Until next time, goodbye.",
          "The meditation is complete‚Äîwell done. Let the benefits of this pause ripple through your day. Until next time, goodbye.",
          "You‚Äôve taken a wonderful time for yourself. May your day continue with ease, balance and clarity. Until next time, goodbye."
        ]
      };

      /* Build base array once */
      const baseSteps = Object.entries(scriptVariations).map(([sec,v])=>({sec:+sec,varis:v}));

      const makePlan = total => {
        const gap = Math.floor(total / (baseSteps.length - 1));
        return baseSteps.map((s,i)=>({t:i*gap,text:rand(s.varis)}));
      };

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Speech helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      const loadVoices = () =>
        new Promise(res=>{
          const ready = () =>{
            speechSynthesis.onvoiceschanged = null;
            res(speechSynthesis.getVoices());
          };
          const v = speechSynthesis.getVoices();
          v.length ? res(v) : (speechSynthesis.onvoiceschanged = ready);
        });

      const pickVoice = vs => {
        const prefs=['Steffan'];
        // const prefs=['Steffan','Christopher','Eric','Liam'];
        const en = vs.filter(v=>v.lang.toLowerCase().startsWith('en'));
        const match = en.filter(v=>prefs.some(n=>new RegExp(`\\b${n}\\b`,'i').test(v.name)));
        return match.length ? rand(match) : en[0] || null;
      };

      const speak = (voice,text)=>new Promise(done=>{
        const u = new SpeechSynthesisUtterance(text);
        u.rate = .85; u.pitch = .5;
        if(voice) u.voice = voice;
        u.onend = done;
        speechSynthesis.speak(u);
      });

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Session control ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      let aborter = null;

      const resetUI = () => {
        if(aborter) aborter.abort();
        speechSynthesis.cancel();
        msg.textContent='';
        speakerLabel.textContent='';
        durMsg.textContent='';
     
      };

      const countdown = (n=7)=>new Promise(res=>{
        const overlay=$('countdown-overlay');
        const num=$('countdown-number');
        overlay.style.display='flex';
        num.textContent=n;
        const iv=setInterval(()=>{
          n--; num.textContent=n;
          if(n===0){
            clearInterval(iv);
            overlay.style.display='none';
            res();
          }
        },1000);
      });

      const runSession = async(plan,dur,voice,signal)=>{
        const start=Date.now();

        for(let i=0;i<plan.length;i++){
          if(signal.aborted) return;
          const wait=plan[i].t*1000-(Date.now()-start);
          if(wait>0) await new Promise(r=>setTimeout(r,wait));
          if(signal.aborted) return;
          msg.textContent=plan[i].text;
          speakerLabel.textContent=voice?`${voice.name}:`:'Default Voice:';
          await speak(voice,plan[i].text);
        }
    
        await new Promise(r=>setTimeout(r,2000));
        window.location.href = window.location.href;
      };

      const start = async totalSeconds=>{
        resetUI();
        durMsg.textContent=`${totalSeconds/60} minutes session in progress...`;
        await countdown();
        const voices=await loadVoices();
        const voice=pickVoice(voices);
        aborter=new AbortController();
        runSession(makePlan(totalSeconds),totalSeconds,voice,aborter.signal)
          .catch(console.error);
      };

      /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Button handlers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      btn5 .addEventListener('click',()=>start(300));
      btn7 .addEventListener('click',()=>start(420));
      btn10.addEventListener('click',()=>start(600));
    })();
  </script>
</body>
</html>
