<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mindfulness Pause</title>
  <style>
    body {
      background-color: #162d4d;
      color: #ffd700;
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 2rem;
    }

    .button-container {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }

    button {
      background-color: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border: 2px solid #ffd700;
      padding: 12px 24px;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: rgba(255, 215, 0, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .progress-container {
      width: 80%;
      max-width: 400px;
      background-color: rgba(255, 215, 0, 0.2);
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background-color: #ffd700;
      width: 0%;
      transition: width 1s linear;
    }

    .timer {
      font-size: 2rem;
      margin-bottom: 20px;
      display: none;
    }

    .controls {
      display: none;
    }

    .message {
      margin-top: 10px;
      font-size: 1.2rem;
      min-height: 50px;
    }

    .speaker-name {
      font-size: 1rem;
      font-style: none;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>üßò‚Äç‚ôÇÔ∏è Mindfulness Pause üßò</h1>
  

  <div class="button-container">
    <button id="five-min">5 Minutes</button>
    <button id="ten-min">10 Minutes</button>
  </div>

  <div class="timer" id="timer">00:00</div>

  <div class="progress-container" id="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>

  <div class="controls" id="controls">
    <button id="pause-play">Pause</button>
  </div>

  <br><br>
  <div class="speaker-name" id="speaker-name"></div>
  <div class="message" id="message"></div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const isEdge = () => {
        const userAgent = navigator.userAgent.toLowerCase();
        return userAgent.includes('edg/');
      };

      if (isEdge()) {
        console.log('OK - MS Edge detected');
      } else {
        alert('This WebApp only works in Microsoft Edge for improved voice quality. Please open this page in Microsoft Edge.');
      }
    });

    const fiveMinBtn = document.getElementById('five-min');
    const tenMinBtn = document.getElementById('ten-min');
    const timerDisplay = document.getElementById('timer');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    const pausePlayBtn = document.getElementById('pause-play');
    const controls = document.getElementById('controls');
    const messageDisplay = document.getElementById('message');
    const speakerNameDisplay = document.getElementById('speaker-name');

    let meditation = null;
    let totalDuration = 0;
    let currentTime = 0;
    let timerInterval = null;
    let isPaused = false;
    let speechQueue = [];
    let currentSpeech = null;
    let selectedVoice = null;

    function loadVoices() {
      speechSynthesis.getVoices();
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    loadVoices();

    function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

const scriptVariations = {
  0: [
    "Let's begin. First, find a comfortable position and gently close your eyes.",
    "Start by settling into a relaxed position. Allow your eyes to softly close.",
    "Begin by finding a comfortable position. Close your eyes gently and rest your hands.",
    "Let's start by sitting comfortably. Close your eyes and bring your focus inward."
  ],
  30: [
    "Take a few deep breaths. In through your nose, and out through your mouth. Let your body settle.",
    "Breathe deeply‚Äîinhale through the nose, exhale slowly through the mouth. Let yourself arrive here.",
    "Slowly take deep breaths. Feel the air enter and leave, grounding you in this moment.",
    "Inhale deeply... exhale fully. Allow each breath to settle your body and mind."
  ],
  60: [
    "Begin to notice how your body feels. Soften any tension in your shoulders, your jaw, your hands. Releasing all tension from head to toe.",
    "Scan your body from head to toe. Relax your shoulders, your face, your hands. Let go of tension.",
    "Tune into your physical body. Gently release any tightness in your jaw, neck, or hands, in all areas.",
    "Feel into your body. Allow each part to soften, your face, your chest, your limbs, the whole body."
  ],
  90: [
    "Bring awareness to surrounding sounds and any sensations. Notice your current mood and any emotions present. Let everything pass like clouds in the sky.",
    "Listen to the sounds around you. Feel sensations as they come and go. Let your emotions be, without judgment.",
    "Observe the moment‚Äîsounds, feelings, thoughts‚Äîwithout clinging. Let everything drift by like clouds.",
    "Notice the world around and within. Allow it all to flow without needing to change anything. Everything comes and goes, you simply observe."
  ],
  120: [
    "...",
    "...",
    "...",
    "..."
  ],
  180: [
    "Settle your attention on the breath. Notice its natural rhythm, rising with the inhale, falling with the exhale. There's nowhere to go, nothing to do.",
    "Bring your focus to the breath. Feel it flow in and out, steady and calm. Just be here.",
    "Notice the breath, how it moves in your body. Let it guide your awareness gently.",
    "Focus on the breath. Inhale, exhale‚Äîlet the natural rhythm soothe you into stillness."
  ],
  240: [
    "Simply witnessing, nothing to change.",
    "Just observe. Nothing needs fixing.",
    "Be the silent observer. Let things be as they are.",
    "Rest in awareness, no resistance."
  ],
  270: [
    "As we begin to close, take one more deep breath in... and slowly exhale.",
    "Take a final deep breath. Inhale peace... exhale tension.",
    "Let‚Äôs end with a deep breath in... and a soft breath out.",
    "Breathe in gently one last time... and breathe out with ease."
  ],
  290: [
    "Gently start to wiggle your fingers and toes. Bring subtle movement back to the body.",
    "Begin to move your body slowly‚Äîwiggle your fingers, your toes, feel into the physical world.",
    "Awaken the body with gentle movements‚Äîstretch or shift softly.",
    "Introduce some small movements back to the body."
  ],
  295: [
    "When you're ready, slowly open your eyes. Carry this sense of stillness and calm with you. Let it guide your next steps.",
    "Slowly open your eyes when you feel ready. Bring this inner peace with you into your day.",
    "Open your eyes at your own pace, bringing a gentle awareness with you.",
    "Let your eyes open gently. Keep the stillness within as you move forward."
  ],
  300: [
  "Your mindfulness pause is complete. Wishing you a peaceful rest of your day.",
  "Your meditation has come to an end. Take this stillness with you‚Äîhave a beautiful day ahead.",
  "You've completed a moment of mindful presence‚Äîwell done. May the rest of your day unfold with ease.",
  "Your short practice is complete. Carry this calm with you into whatever comes next. Be well."
]
};

// Build the randomized session
function generateFiveMinuteMeditation() {
  return Object.entries(scriptVariations).map(([time, variations]) => ({
    time: Number(time),
    text: getRandom(variations)
  }));
}

const baseScriptSteps = Object.entries(scriptVariations)
  .map(([time, variations]) => ({
    originalTime: Number(time),
    variations
  }));

  function generateStretchedTenMinuteMeditation() {
  const totalDuration = 600;
  const numSteps = baseScriptSteps.length;
  const spacing = Math.floor(totalDuration / (numSteps - 1)); // space between steps

  return baseScriptSteps.map((step, index) => {
    const newTime = index * spacing;
    return {
      time: newTime,
      text: getRandom(step.variations)
    };
  });
}


    function speak(text) {
      return new Promise((resolve) => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.8;
        utterance.pitch = 0.5;

        if (selectedVoice) {
          utterance.voice = selectedVoice;
          speakerNameDisplay.textContent = `${selectedVoice.name}:`;
        } else {
          speakerNameDisplay.textContent = `Default Voice:`;
        }

        utterance.onend = resolve;
        currentSpeech = utterance;
        speechSynthesis.speak(utterance);
      });
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
      const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
      return `${mins}:${secs}`;
    }

    function updateProgress() {
      timerDisplay.textContent = formatTime(currentTime);
      const progress = (currentTime / totalDuration) * 100;
      progressBar.style.width = `${progress}%`;
    }

    async function processInstructions(meditationScript) {
      for (const instruction of meditationScript) {
        if (instruction.time === currentTime) {
          messageDisplay.textContent = instruction.text;
          if (!isPaused) {
            await speak(instruction.text);
          } else {
            speechQueue.push(instruction.text);
          }
        }
      }
    }

    function startMeditation(meditationScript, duration) {
      speechSynthesis.cancel();
      speechQueue = [];
      currentSpeech = null;
      currentTime = 0;
      totalDuration = duration;
      meditation = meditationScript;
      isPaused = false;

      const voices = speechSynthesis.getVoices();


      const enVoices = voices.filter(voice => {
  const lang = voice.lang.toLowerCase();
  return (
    lang === 'en-us' ||
    lang === 'en-gb' ||
    lang.includes('en-us') ||
    lang.includes('en-gb') ||
    lang.includes('english')
  );
});


      enVoices.forEach((voice, index) => {
  console.log(`FILTERED FOUND ${index + 1}: ${voice.name} (${voice.lang}) - ${voice.default ? "Default" : "Not default"}`);
});

const preferredNames = [
  "Christopher", "Eric", "Steffan", "Jenny", "Jenny"
];

      const matchingVoices = enVoices.filter(voice =>
        preferredNames.some(name =>
          voice.name.toLowerCase().includes(name.toLowerCase())
        )
      );

      matchingVoices.forEach((voice, index) => {
  console.log(`PREFFERED MATCHING ${index + 1}: ${voice.name} (${voice.lang}) - ${voice.default ? "Default" : "Not default"}`);
});


      selectedVoice = matchingVoices.length > 0
        ? matchingVoices[Math.floor(Math.random() * matchingVoices.length)]
        : null;

      
  console.log(`RANDOM SELECTION ${selectedVoice.name}`);

    //  fiveMinBtn.disabled = true;
    //  tenMinBtn.disabled = true;

      timerDisplay.style.display = 'block';
      progressContainer.style.display = 'block';
      controls.style.display = 'block';
      pausePlayBtn.textContent = 'Pause';

      updateProgress();

      timerInterval = setInterval(() => {
        if (!isPaused) {
          currentTime++;
          updateProgress();
          processInstructions(meditation);

          
        }
      }, 1000);

      processInstructions(meditation);
    }

    function togglePause() {
      isPaused = !isPaused;

      if (isPaused) {
        pausePlayBtn.textContent = 'Play';
        speechSynthesis.pause();
      } else {
        pausePlayBtn.textContent = 'Pause';
        speechSynthesis.resume();

        if (speechQueue.length > 0 && !currentSpeech) {
          const nextSpeech = speechQueue.shift();
          speak(nextSpeech);
        }
      }
    }

    function resetMeditation() {
  clearInterval(timerInterval);
  speechSynthesis.cancel();
  messageDisplay.textContent = '';
  speakerNameDisplay.textContent = '';
  timerDisplay.textContent = '00:00';
  progressBar.style.width = '0%';
  currentSpeech = null;
  speechQueue = [];
  currentTime = 0;
  isPaused = false;
}


fiveMinBtn.addEventListener('click', () => {
  const freshFiveMinScript = generateFiveMinuteMeditation();
  resetMeditation(); // Reset everything first
  startMeditation(freshFiveMinScript, 300);
});


tenMinBtn.addEventListener('click', () => {
  const stretchedTenMinScript = generateStretchedTenMinuteMeditation();
  resetMeditation();
  startMeditation(stretchedTenMinScript, 600);
});


    pausePlayBtn.addEventListener('click', togglePause);
  </script>
</body>
</html>
